# Выполнение тестового задания

## Чистка багов, подготовка к рефакторингу

Начав выполнение задания с первого пункта, с рефакторинга, увидел наличие большого количества багов в предоставленном коде и принял решение сначала сделать приложение и покрыть тестами success path. Этот пункт выполнил в ветке `feature/preparation`, в ветке `step-1` привёл код интерактора в рабочий вид и добился работы тестов интерактора и контроллера

Баги выловленные на шаге `step-1`:

* исправлены ассоциации с `has_many` на `habtm` и созданы джойн таблицы для связей интересты-пользователи и скилы-пользователи (в соответствии с логикой прописанной в интеракторе)
* исправлена опечатка `!= female` на `!= 'female'`
* исправлена опечатка `Intereset` на `Interest`
* исправлена логическая ошибка `return if params['gender'] != 'male' or params['gender'] != female` на `return if params['gender'] != 'male' and params['gender'] != female`
* исправлена логическая ошибка `return if User.where(email: params['email'])` на `return if User.where(email: params['email']).first`
* исправлена синтаксическая ошибка `user = User.create(user_params.merge(user_full_name))` на `user = User.create(user_params.merge(full_name: user_full_name))`
* исправлена синтаксическая ошибка `skil = Skil.find(name: skil)` на `skil = Skil.find_by(name: skil)`

В итоге, получили работающий код интерактора, переключаемся на ветку `step-2`

## Рефакторинг

* изменена схема параметров, функция входной проверки параметров перенесена на схему
* валидация параметров вынесена в ActiveModel валидации, включая кастомную проверку на уникальность емайла
* код поделен на методы
* изменена валидация для интересов и скилов, допускается их отсутствие, в соответствии с кодом интерактора, специальный случай прописан в тестах
* выполнено исправление опечатки `Skil` на `Skill` (быстрым способом)

## Два способа починки опечатки

Первый способ быстрый. Позволяет поправить опечатку здесь и сейчас и продолжить работу над задачей. Создаем унаследованный от нашей модели с опечаткой класс, задавая ему правильное имя. Заменяем обращения по старому имени класса на новое. Продолжаем работу, оставляя длительную миграцию на позже

Второй способ длительный. У нас из-за опечатки неверно проименованы таблицы, классы и ассоциации. Сначала создаем миграции для модели и для всех джойн таблиц, копируем в них данные, для модели и связанных классов исправляем упомянутые имена класса, исправляем названия связей/методов подлежащих переименованию, тотальным поиском по всему коду находим обращения к старому имени/старым именам связей, заменяем.

Третий способ - сначала применить первый, потом второй. В отдельных ветках.

## Тестовое задание, список задач

1. Использовать gem `ActiveInteraction => https://github.com/AaronLasseigne/active_interaction` отрефакторить класс `Users::Create`
2. Исправить опечатку `Skil`. Есть 2 пути решения. Описать оба.
3. Исправить связи
4. Поднять `Rails` приложение и в нем использовать класс `Users::Create`
5. Написать тесты
6. При рефакторнге кода использовать Декларативное описание(подход в программировании)
